<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
    <title>
            Exercise 1: Implement an external app and authenticate a user
        </title>
    <link rel="stylesheet" type="text/css" href="./res/styles/normalize.css">
    <link rel="stylesheet" type="text/css" href="./res/styles/prettify.css" />
    <link rel="stylesheet" type="text/css" href="./res/styles/styles.css">
</head>

<body>
    <!-- Use the same title as the StartHere -->
    <header>Using the Xamarin Salesforce Component</header>

    <section id="main">

        <!-- ------------------------------------------------------------------------------------------------------------------------- -->

        <h1 id="page-title"></h1>

        <!-- ------------------------------------------------------------------------------------------------------------------------- -->

        <h2>Duration</h2>
        <p>
            20 minutes
        </p>

        <!-- ------------------------------------------------------------------------------------------------------------------------- -->

        <h2>Goals</h2>

        <p>
            The goal of this lab is to instantiate a <code>SalesforceClient</code> and use it to display the Salesforce login UI.
        </p>

        <!-- ------------------------------------------------------------------------------------------------------------------------- -->

        <h2>Required assets</h2>
        <p>
            The provided <strong>Resources</strong> folder for this exercise contains a subfolder named <strong>Start</strong>
            that contains the required starter project you will use here. There is also a <strong>Completed</strong>
            folder with a solution you can use to check your work.
        </p>

        <!-- ------------------------------------------------------------------------------------------------------------------------- -->

        <h2>Exercise overview</h2>
        <p>
            You will create a <code>SalesforceClient</code> object and display the login UI. To let you spend your time on
            Salesforce-related code rather than Xamarin.Forms UI, the provided starter solution contains the majority of
            the platform-specific code needed to display the login UI on both Android and iOS.
        </p>
        <p>
            <ol>
                <li>Create constants for your ConsumerKey, ConsumerSecret, and CallbackUrl.</li>
                <li>Create a <code>SalesforceClient</code> object.</li>
                <li>
                    Obtain the login UI from the <code>SalesforceClient</code> and pass it to the pre-written, platform-specific
                    code for display.
                </li>
            </ol>
        </p>

        <!-- ------------------------------------------------------------------------------------------------------------------------- -->

        <h1>Steps</h1>
        <p>
            Below are the step-by-step instructions to implement the exercise.
        </p>

        <h2>Explore the starter code</h2>
        <ol>
            <li>
                Open the <strong>MyCampaigns</strong> solution from the <strong>Exercise 1</strong> subfolder <strong>Lab.Start</strong>.
            </li>

            <li>
                Verify that the Salesforce Component has been added to the Android and iOS projects.
            </li>

            <li>
                Open <strong>MyCampaigns.cs</strong>. Find the property named <code>Platform</code>. Notice that its type is <code>IAdapter</code>.
                This will be set from the platform-specific code. When run on Android, it will be your main activity. When run on iOS, it will be
                your application delegate. This is what you will use to diplay the login UI.
            </li>

            <li>
                Open <code>IAdapter.cs</code>. Notice that there are two methods, one to display some UI and one to clean up when you are
                finished with the UI.
            </li>

            <li>
                Open <code>MainActivity.cs</code>. Find the line in <code>OnCreate</code> where the activity loads itself into the App's
                <code>Platform</code> property. Note that the activity implements the <code>IAdapter</code> interface and displays the
                passed UI in a typical way for Android, by starting an Activity.
            </li>

            <li>
                Open <code>AppDelegate.cs</code>. Find the line in <code>FinishedLaunching</code> where the delegate loads itself into the App's
                <code>Platform</code> property. Note that the delegate implements the <code>IAdapter</code> interface. The code to display the
                passed UI is more complex than normal for iOS because the app's main window is inaccessible; therefore, we had to create a new
                window to display the login UI. This window is only temporary and will be disposed when the login UI is no longer needed.
            </li>

            <li>
                Open <strong>MyCampaigns.cs</strong>. Take a moment to examine the control flow through the <code>OnStart</code> method.
                In particular, notice the logic that handles the two cases of whether a user is already authenticated or not. If they
                are not authenticated, we display the login UI, then show our data page after they finish logging in. If they are already
                authenticated, we go to our data page immediately.
            </li>
        </ol>

        <h2>Complete the implementation</h2>
        <ol>
            <li>
                Open <code>MyCampaigns.cs</code>.
            </li>

            <li>
                Retrieve your Connected App's <strong>ConsumerKey</strong>, <strong>ConsumerSecret</strong>, and <strong>CallbackUrl</strong> 
                from your Salesforce account (the Salesforce login page is <a target="_blank" href="https://login.salesforce.com">here</a>). 
                Add your Connected App's values to the <code>ConsumerKey</code>, <code>ConsumerSecret</code>, and <code>CallbackUrl</code> fields.
            </li>

            <li>
                In <code>OnStart</code>, create a <code>SalesforceClient</code> object and assign it to the <code>Client</code> property.
            </li>

            <li>
                Run your app on at least one platform to test your work. The first time you run, you should see the Salesforce login UI displayed.
                If you run the app again, you should bypass the login screen and go straight to the data page (which will be empty at this point).
            </li>
        </ol>
        </p>

        <!-- ------------------------------------------------------------------------------------------------------------------------- -->

        <h1>Summary</h1>
        <p>
            This exercise dealt with all the platform-specific details you needed to handle to display your Salesforce login UI
            on multiple platforms. You now have a <code>SalesforceClient</code> object with an authenticated user so you are
            ready to start querying Salesforce data.
        </p>
        <div class="align-right">
            <a href="../Start%20Here.html">Go Back</a>
        </div>
    </section>

    <script src="./res/js/jquery.min.js"></script>
    <script src="./res/js/prettify.js"></script>
    <script src="./res/js/script.js"></script>

    <footer>Copyright (C) 2018 Xamarin Inc., Microsoft.</footer>
</body>
</html>
